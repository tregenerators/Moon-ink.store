<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Moon Inc. ‚Äî Cosmic Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #020312;
      --bg-elevated: #08091b;
      --bg-soft: #101227;
      --accent: #8e5cff;
      --accent-soft: rgba(142, 92, 255, 0.23);
      --accent-alt: #4ad0ff;
      --text: #f5f5ff;
      --text-muted: #a1a2ca;
      --danger: #ff4b6a;
      --success: #48ffb3;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.8);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-pill: 999px;
      --transition-fast: 0.16s ease-out;
      --transition-med: 0.22s ease-out;
      --header-h: 72px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }
    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; }

    /* Canvas starfield */
    #starfield {
      position: fixed;
      inset: 0;
      z-index: -1;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      height: var(--header-h);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.4rem;
      backdrop-filter: blur(18px);
      background: linear-gradient(to bottom, rgba(2,3,18,0.98), rgba(2,3,18,0.86), transparent);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      font-weight: 700;
      letter-spacing: 0.09em;
      font-size: 0.96rem;
      text-transform: uppercase;
    }
    .brand-icon {
      width: 30px; height: 30px;
      border-radius: 30%;
      background: radial-gradient(circle at 30% 20%, #fff, #d5c3ff 30%, #8e5cff 65%, #120822);
      box-shadow: 0 0 16px rgba(142,92,255,0.9);
    }
    nav {
      display: flex;
      gap: 0.8rem;
      font-size: 0.9rem;
    }
    nav a {
      padding: 0.35rem 0.8rem;
      border-radius: var(--radius-pill);
      color: var(--text-muted);
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }
    nav a:hover {
      background: rgba(255,255,255,0.06);
      color: var(--text);
      transform: translateY(-1px);
    }

    .layout {
      max-width: 1140px;
      margin: 0 auto;
      padding: 2.5rem 1.4rem 3rem;
    }

    .hero {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.3fr);
      gap: 2rem;
      align-items: center;
      margin-bottom: 2.2rem;
    }
    .hero-kicker {
      font-size: 0.8rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--accent-alt);
      padding: 0.2rem 0.55rem;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(74,208,255,0.55);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      background: rgba(6,12,30,0.8);
      margin-bottom: 0.6rem;
    }
    .hero-kicker-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 10px var(--success);
    }
    h1.hero-title {
      font-size: clamp(2.2rem, 3vw + 1.2rem, 3.4rem);
      line-height: 1.05;
      letter-spacing: -0.03em;
      margin-bottom: 0.7rem;
    }
    h1.hero-title span {
      background: linear-gradient(90deg,#fff,var(--accent),var(--accent-alt));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .hero-sub {
      color: var(--text-muted);
      font-size: 0.95rem;
      max-width: 34rem;
      margin-bottom: 1.2rem;
    }
    .hero-cta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.7rem;
      margin-bottom: 0.8rem;
    }
    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid transparent;
      padding: 0.52rem 1.1rem;
      font-size: 0.86rem;
      font-weight: 500;
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      box-shadow: 0 10px 25px rgba(142,92,255,0.5);
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), filter var(--transition-fast), background var(--transition-fast);
    }
    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.07);
      box-shadow: 0 15px 32px rgba(142,92,255,0.7);
    }
    .btn-outline {
      background: rgba(7,9,25,0.9);
      border-color: rgba(255,255,255,0.16);
      color: var(--text-muted);
      box-shadow: none;
    }
    .btn-outline:hover {
      background: rgba(255,255,255,0.06);
      color: var(--text);
    }
    .hero-micro {
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .hero-micro strong { color: var(--accent-alt); }

    .hero-card {
      border-radius: 20px;
      background: radial-gradient(circle at top,#262650 0,#101021 55%,#050510 100%);
      border: 1px solid rgba(255,255,255,0.1);
      padding: 1rem;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      min-height: 220px;
    }
    .hero-card::before {
      content: "";
      position: absolute;
      inset: -50%;
      background:
        radial-gradient(circle at 0% 0%,rgba(142,92,255,0.5),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(74,208,255,0.35),transparent 55%);
      opacity: 0.35;
      pointer-events: none;
    }
    .hero-card-inner {
      position: relative;
      z-index: 1;
    }
    .hero-card-top {
      display: flex; justify-content: space-between; align-items: center;
      font-size: 0.8rem;
      margin-bottom: 1rem;
    }
    .hero-pill {
      padding: 0.22rem 0.7rem;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(4,5,18,0.7);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      font-size: 0.7rem;
      color: #d3d4ff;
    }
    .hero-status {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.55rem;
      border-radius: var(--radius-pill);
      background: rgba(3,7,22,0.9);
      font-size: 0.76rem;
      color: var(--text-muted);
    }
    .hero-status-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 9px var(--success);
    }
    .hero-card-main {
      margin-bottom: 0.7rem;
    }
    .hero-metric {
      font-size: 2rem;
      font-weight: 650;
      letter-spacing: -0.05em;
      margin-bottom: 0.1rem;
    }
    .hero-metric-label {
      font-size: 0.78rem;
      color: #d6d6ff;
    }
    .hero-spark {
      margin-top: 0.8rem;
      height: 54px;
      border-radius: 14px;
      background: linear-gradient(135deg,rgba(142,92,255,0.26),rgba(12,234,198,0.2));
      position: relative;
      overflow: hidden;
    }
    .hero-spark::before {
      content:"";
      position:absolute;
      inset: 16px 8px;
      border-radius:999px;
      border:1px dashed rgba(255,255,255,0.18);
    }
    .hero-spark::after {
      content:"";
      position:absolute;
      inset:0;
      background-image:linear-gradient(120deg,rgba(255,255,255,0) 0%,rgba(255,255,255,0.7) 45%,rgba(255,255,255,0) 100%);
      mix-blend-mode:screen;
      opacity:0.5;
      transform:translateX(-70%);
      animation: spark 4s infinite;
    }
    @keyframes spark {
      0% { transform: translateX(-80%); }
      50% { transform: translateX(10%); }
      100% { transform: translateX(120%); }
    }
    .hero-card-bottom {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:0.78rem;
      color:var(--text-muted);
      margin-top:0.5rem;
    }

    .divider {
      height:1px;
      width:100%;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,0.18),transparent);
      margin:2.3rem 0 1.8rem;
    }

    .section-header {
      display:flex;
      justify-content:space-between;
      gap:1rem;
      margin-bottom:1rem;
      align-items:flex-end;
    }
    .section-header h2 {
      font-size:1.5rem;
      letter-spacing:-0.02em;
    }
    .section-sub {
      font-size:0.88rem;
      color:var(--text-muted);
      max-width:320px;
    }

    /* Shop grid */
    .shop-layout {
      display:grid;
      grid-template-columns: minmax(0, 3.2fr) minmax(0, 1.7fr);
      gap:1.8rem;
      align-items:flex-start;
    }
    .category-tabs {
      display:flex;
      flex-wrap:wrap;
      gap:0.4rem;
      margin-bottom:0.85rem;
    }
    .chip {
      padding:0.22rem 0.7rem;
      font-size:0.8rem;
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,0.1);
      color:var(--text-muted);
      background:rgba(7,8,21,0.85);
      cursor:pointer;
      transition: var(--transition-fast);
    }
    .chip.active {
      background:var(--accent-soft);
      color:var(--accent-alt);
      border-color:rgba(142,92,255,0.7);
    }
    .product-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(190px,1fr));
      gap:1rem;
    }
    .card {
      background:rgba(7,8,26,0.96);
      border-radius:var(--radius-lg);
      padding:0.7rem;
      border:1px solid var(--border-subtle);
      box-shadow:0 14px 35px rgba(0,0,0,0.8);
      display:flex;
      flex-direction:column;
      gap:0.45rem;
      transition:transform var(--transition-med), box-shadow var(--transition-med), border-color var(--transition-med);
      position:relative;
      overflow:hidden;
    }
    .card:hover {
      transform:translateY(-3px);
      box-shadow:0 18px 45px rgba(0,0,0,0.9);
      border-color:rgba(142,92,255,0.55);
    }
    .card-featured-tag {
      position:absolute;
      top:0.5rem;
      left:0.55rem;
      font-size:0.7rem;
      padding:0.15rem 0.5rem;
      border-radius:var(--radius-pill);
      background:rgba(255,215,0,0.1);
      border:1px solid rgba(255,215,0,0.6);
      color:#ffd866;
      text-transform:uppercase;
      letter-spacing:0.12em;
    }
    .card-img {
      width:100%;
      aspect-ratio:4/3;
      border-radius:12px;
      background:radial-gradient(circle at top,#404080,#080815);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.5rem;
      color:rgba(255,255,255,0.7);
      overflow:hidden;
    }
    .card-img img {
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .card-title {
      font-size:0.95rem;
      font-weight:550;
    }
    .card-meta {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:0.8rem;
      color:var(--text-muted);
    }
    .price {
      font-weight:600;
      color:#fff;
      font-size:0.95rem;
    }
    .badge {
      font-size:0.7rem;
      padding:0.16rem 0.5rem;
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,0.18);
    }
    .badge-rare { color:#ffce6b; border-color:rgba(255,206,107,0.7); }
    .badge-legendary { color:#ff7bfb; border-color:rgba(255,123,251,0.75); }
    .badge-common { color:var(--text-muted); }
    .stock {
      font-size:0.75rem;
      color:var(--text-muted);
    }
    .card-footer {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:0.4rem;
      margin-top:0.3rem;
    }
    .btn-sm {
      padding:0.35rem 0.7rem;
      font-size:0.8rem;
      border-radius:var(--radius-pill);
      border:1px solid transparent;
      background:var(--accent-soft);
      color:#fff;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:0.25rem;
      transition:var(--transition-fast);
    }
    .btn-sm:hover {
      filter:brightness(1.1);
      border-color:rgba(255,255,255,0.2);
    }
    .btn-sm-ghost {
      background:transparent;
      border-color:rgba(255,255,255,0.22);
      color:var(--text-muted);
    }

    /* Cart / summary panel */
    .cart-panel {
      background:var(--bg-soft);
      border-radius:var(--radius-lg);
      padding:0.9rem;
      border:1px solid var(--border-subtle);
      box-shadow:var(--shadow-soft);
      position:sticky;
      top:calc(var(--header-h) + 1.5rem);
    }
    .cart-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:0.5rem;
    }
    .cart-title {
      font-size:1rem;
      font-weight:550;
    }
    .cart-count {
      font-size:0.8rem;
      color:var(--text-muted);
    }
    .cart-items {
      max-height:260px;
      overflow:auto;
      padding-right:0.3rem;
      margin-bottom:0.7rem;
      scrollbar-width:thin;
    }
    .cart-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:0.8rem;
      padding:0.35rem 0;
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .cart-item:last-child {
      border-bottom:none;
    }
    .cart-item-main {
      display:flex;
      flex-direction:column;
    }
    .cart-item-name { font-weight:500; }
    .cart-item-meta {
      color:var(--text-muted);
      font-size:0.75rem;
    }
    .cart-item-actions {
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:0.2rem;
    }
    .qty-controls {
      display:flex;
      align-items:center;
      gap:0.28rem;
      font-size:0.75rem;
    }
    .qty-btn {
      width:18px; height:18px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.4);
      background:transparent;
      color:#fff;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:0.72rem;
      padding:0;
    }
    .cart-footer {
      border-top:1px solid rgba(255,255,255,0.12);
      padding-top:0.5rem;
      display:flex;
      flex-direction:column;
      gap:0.35rem;
      font-size:0.82rem;
    }
    .cart-row {
      display:flex;
      justify-content:space-between;
    }
    .cart-total {
      font-size:0.92rem;
      font-weight:600;
    }
    .cart-empty {
      font-size:0.8rem;
      color:var(--text-muted);
      margin-bottom:0.7rem;
    }

    /* Modals */
    .modal-backdrop {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.7);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:40;
    }
    .modal-backdrop.show { display:flex; }
    .modal {
      width:100%;
      max-width:480px;
      border-radius:20px;
      background:var(--bg-soft);
      border:1px solid rgba(255,255,255,0.16);
      box-shadow:0 20px 50px rgba(0,0,0,0.85);
      padding:1.1rem 1.1rem 1rem;
    }
    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:0.4rem;
    }
    .modal-title {
      font-size:1rem;
      font-weight:560;
    }
    .modal-close {
      border:0;
      background:transparent;
      color:var(--text-muted);
      font-size:1.2rem;
      cursor:pointer;
    }
    .modal-body {
      font-size:0.86rem;
      color:var(--text-muted);
      max-height:360px;
      overflow:auto;
    }
    .field {
      margin:0.45rem 0;
    }
    .field label {
      font-size:0.8rem;
      color:var(--text-muted);
      display:block;
      margin-bottom:0.18rem;
    }
    .field input, .field textarea, .field select {
      width:100%;
      padding:0.48rem 0.6rem;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(4,5,18,0.96);
      color:var(--text);
      font-size:0.85rem;
      outline:none;
      transition:border var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
      resize:vertical;
    }
    .field input:focus, .field textarea:focus, .field select:focus {
      border-color:rgba(142,92,255,0.9);
      box-shadow:0 0 0 1px rgba(142,92,255,0.7);
      background:rgba(2,3,15,0.98);
    }
    .field small {
      font-size:0.75rem;
      color:var(--text-muted);
    }
    .error-text {
      font-size:0.75rem;
      color:var(--danger);
      margin-top:0.15rem;
      display:none;
    }
    .modal-footer {
      margin-top:0.8rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:0.7rem;
    }
    .note {
      font-size:0.76rem;
      color:var(--text-muted);
    }

    /* Vouch list */
    .vouch-section {
      margin-top:2.2rem;
    }
    .vouch-list {
      margin-top:0.6rem;
      display:flex;
      flex-direction:column;
      gap:0.4rem;
      font-size:0.8rem;
    }
    .vouch-item {
      border-radius:var(--radius-md);
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(7,8,24,0.96);
      padding:0.55rem 0.65rem;
    }
    .vouch-stars {
      color:#ffd866;
      font-size:0.85rem;
      margin-bottom:0.1rem;
    }
    .vouch-meta {
      color:var(--text-muted);
      font-size:0.75rem;
    }

    /* Admin panel slide-out */
    .admin-toggle {
      position:fixed;
      left:0.7rem;
      bottom:0.7rem;
      z-index:30;
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,0.2);
      background:rgba(5,6,19,0.96);
      color:var(--text-muted);
      font-size:0.78rem;
      padding:0.3rem 0.8rem;
      display:inline-flex;
      align-items:center;
      gap:0.4rem;
      cursor:pointer;
      box-shadow:0 10px 30px rgba(0,0,0,0.8);
    }
    .admin-panel {
      position:fixed;
      top:0;
      right:-420px;
      width:380px;
      max-width:100%;
      height:100vh;
      background:var(--bg-soft);
      border-left:1px solid rgba(255,255,255,0.12);
      box-shadow:-22px 0 40px rgba(0,0,0,0.9);
      z-index:50;
      display:flex;
      flex-direction:column;
      transition:right var(--transition-med);
    }
    .admin-panel.open { right:0; }
    .admin-header {
      padding:0.9rem 0.9rem 0.6rem;
      border-bottom:1px solid rgba(255,255,255,0.1);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:0.4rem;
    }
    .admin-title {
      font-size:0.98rem;
      font-weight:560;
    }
    .admin-body {
      flex:1;
      padding:0.6rem 0.9rem 0.8rem;
      overflow:auto;
      font-size:0.8rem;
      color:var(--text-muted);
    }
    .admin-section-title {
      font-size:0.8rem;
      text-transform:uppercase;
      letter-spacing:0.16em;
      color:var(--accent-alt);
      margin:0.4rem 0;
    }
    .admin-table {
      width:100%;
      border-collapse:collapse;
      font-size:0.76rem;
      margin-bottom:0.5rem;
    }
    .admin-table th, .admin-table td {
      border-bottom:1px solid rgba(255,255,255,0.1);
      padding:0.25rem 0.2rem;
      text-align:left;
    }
    .admin-table th {
      font-weight:500;
      color:var(--text-muted);
    }
    .admin-table input, .admin-table select {
      width:100%;
      font-size:0.72rem;
      padding:0.22rem 0.28rem;
      border-radius:6px;
      border:1px solid rgba(255,255,255,0.2);
      background:rgba(3,4,16,0.96);
      color:var(--text);
    }
    .admin-actions {
      display:flex;
      flex-wrap:wrap;
      gap:0.3rem;
      margin:0.4rem 0 0.6rem;
    }
    .btn-xs {
      font-size:0.72rem;
      padding:0.22rem 0.45rem;
      border-radius:var(--radius-pill);
      border:1px solid rgba(255,255,255,0.2);
      background:rgba(4,5,16,0.96);
      color:var(--text-muted);
      cursor:pointer;
    }
    .btn-xs-primary {
      background:var(--accent-soft);
      border-color:rgba(142,92,255,0.8);
      color:#fff;
    }
    .admin-log {
      font-size:0.75rem;
      max-height:120px;
      overflow:auto;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.12);
      padding:0.4rem;
      background:rgba(3,4,14,0.96);
    }
    .admin-log p {
      margin-bottom:0.15rem;
    }

    footer {
      border-top:1px solid rgba(255,255,255,0.08);
      padding:1.2rem 1.4rem 1.7rem;
      font-size:0.8rem;
      color:var(--text-muted);
      background:rgba(1,2,10,0.96);
      margin-top:2.4rem;
    }
    .footer-inner {
      max-width:1140px;
      margin:0 auto;
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      gap:0.8rem;
    }

    @media (max-width: 900px) {
      .hero {
        grid-template-columns:minmax(0,1fr);
      }
      .hero-card {
        max-width:420px;
        margin:0 auto;
      }
      .shop-layout {
        grid-template-columns: minmax(0,1fr);
      }
      .cart-panel {
        position:static;
        top:auto;
      }
    }
    @media (max-width: 600px) {
      header {
        padding-inline:0.9rem;
      }
      .layout {
        padding-inline:1rem;
      }
      nav { display:none; }
      .hero {
        margin-bottom:1.7rem;
      }
    }
  </style>
</head>
<body>
<canvas id="starfield"></canvas>

<header>
  <div class="brand">
    <div class="brand-icon"></div>
    <span>Moon Inc.</span>
  </div>
  <nav>
    <a href="#featured">Featured</a>
    <a href="#shop">Shop</a>
    <a href="#vouches">Vouches</a>
    <a href="#contact">Contact</a>
  </nav>
</header>

<div class="layout">
  <section class="hero">
    <div>
      <div class="hero-kicker">
        <span class="hero-kicker-dot"></span>
        Cosmic-Grade Item Storefront
      </div>
      <h1 class="hero-title">
        Run your <span>Moon Inc.</span> shop like a real business.
      </h1>
      <p class="hero-sub">
        Spawners, kits, and currency bundles ‚Äî with admin controls, anonymous vouches,
        Discord + IGN collection, and a starfield that never sleeps.
      </p>
      <div class="hero-cta">
        <button class="btn" id="scrollToShop">Open the shop</button>
        <button class="btn-outline" id="scrollToVouches">View vouches</button>
      </div>
      <p class="hero-micro">
        Cart requires <strong>Discord</strong> and <strong>Minecraft IGN</strong> at checkout. Payments are wired for Stripe-style flow.
      </p>
    </div>
    <aside class="hero-card" aria-hidden="true">
      <div class="hero-card-inner">
        <div class="hero-card-top">
          <span class="hero-pill">Live Store Snapshot</span>
          <span class="hero-status">
            <span class="hero-status-dot"></span>
            Online ‚Ä¢ EST
          </span>
        </div>
        <div class="hero-card-main">
          <div class="hero-metric" id="heroOrdersMetric">0</div>
          <div class="hero-metric-label">Orders logged via Moon Inc. panel</div>
          <div class="hero-spark"></div>
        </div>
        <div class="hero-card-bottom">
          <div>
            <div style="font-size:0.74rem;color:var(--text-muted);">Avg. vouch rating</div>
            <div id="heroAvgRating" style="font-size:0.95rem;font-weight:560;">‚Äî</div>
          </div>
          <div>
            <div style="font-size:0.74rem;color:var(--text-muted);">Rotation items archived</div>
            <div id="heroArchivedCount" style="font-size:0.95rem;font-weight:560;">0</div>
          </div>
        </div>
      </div>
    </aside>
  </section>

  <div class="divider" id="featured"></div>

  <section>
    <div class="section-header">
      <div>
        <h2>Featured drops</h2>
      </div>
      <p class="section-sub">
        Highlight your most important offers. Edit these anytime from the admin panel ‚Äî prices, stock, names, and more.
      </p>
    </div>
    <div id="featuredGrid" class="product-grid"></div>
  </section>

  <div class="divider" id="shop"></div>

  <section>
    <div class="section-header">
      <div>
        <h2>Shop catalog</h2>
      </div>
      <p class="section-sub">
        Spawners, kits, and currency bundles ‚Äî filter by category, then toss items into the cart to check out.
      </p>
    </div>

    <div class="shop-layout">
      <div>
        <div class="category-tabs">
          <button class="chip active" data-category="all">All</button>
          <button class="chip" data-category="spawner">Spawners</button>
          <button class="chip" data-category="kit">Kits</button>
          <button class="chip" data-category="currency">Currency Bundles</button>
        </div>
        <div id="productGrid" class="product-grid"></div>
      </div>

      <aside class="cart-panel" id="cartPanel">
        <div class="cart-header">
          <div>
            <div class="cart-title">Cart</div>
            <div class="cart-count" id="cartCountText">0 items</div>
          </div>
        </div>
        <div id="cartItems" class="cart-items"></div>
        <div class="cart-footer">
          <div class="cart-row">
            <span>Subtotal</span>
            <span id="cartSubtotal">$0.00</span>
          </div>
          <div class="cart-row">
            <span>Fees &amp; misc.</span>
            <span id="cartFees">$0.00</span>
          </div>
          <div class="cart-row cart-total">
            <span>Total</span>
            <span id="cartTotal">$0.00</span>
          </div>
          <button class="btn" id="checkoutBtn">Checkout</button>
          <div id="cartEmptyText" class="cart-empty" style="display:none;">
            Your cart is empty. Add something cosmic first.
          </div>
        </div>
      </aside>
    </div>
  </section>

  <section class="vouch-section" id="vouches">
    <div class="section-header">
      <div>
        <h2>Vouches (anonymous)</h2>
      </div>
      <p class="section-sub">
        Buyers leave 1‚Äì5 star ratings. Publicly, only masked names and EST timestamps show. Admin + webhook see full details.
      </p>
    </div>
    <div id="vouchList" class="vouch-list"></div>
  </section>

  <div class="divider" id="contact"></div>

  <section>
    <div class="section-header">
      <div>
        <h2>Contact + order info</h2>
      </div>
      <p class="section-sub">
        Edit this area with your real Discord, email, or server details. The checkout form already requires Discord and IGN.
      </p>
    </div>
    <p style="font-size:0.86rem;color:var(--text-muted);max-width:520px;">
      Example:
      <br>Discord: <code>@YourAdminTag</code>
      <br>Support server: <code>discord.gg/yourserver</code>
      <br>Response time: usually under 24 hours.
    </p>
  </section>
</div>

<footer>
  <div class="footer-inner">
    <span>¬© <span id="yearSpan"></span> Moon Inc. ‚Ä¢ All rights reserved.</span>
    <span style="font-size:0.78rem;">Times shown as EST for logs and vouches.</span>
  </div>
</footer>

<!-- Checkout modal -->
<div class="modal-backdrop" id="checkoutBackdrop">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Checkout ‚Äî Moon Inc.</div>
      <button class="modal-close" data-close="checkoutBackdrop">&times;</button>
    </div>
    <div class="modal-body">
      <p style="margin-bottom:0.6rem;">
        Fill this out so your order can be verified. Your Discord and IGN are only visible to admins and in Discord logs ‚Äî never public.
      </p>
      <div class="field">
        <label for="checkoutDiscord">Discord</label>
        <input id="checkoutDiscord" placeholder="user#0000 or @user" />
        <div id="checkoutDiscordError" class="error-text">Please enter a valid Discord handle.</div>
      </div>
      <div class="field">
        <label for="checkoutIGN">Minecraft IGN</label>
        <input id="checkoutIGN" placeholder="Exact in-game name" />
        <div id="checkoutIGNError" class="error-text">Please enter your IGN.</div>
      </div>
      <div class="field">
        <label for="checkoutNote">Notes (optional)</label>
        <textarea id="checkoutNote" rows="3" placeholder="Any extra info or requests."></textarea>
      </div>
      <p class="note" style="margin-top:0.6rem;">
        Payment is simulated as a Stripe-style flow on this file. For real payments, connect this to your backend and Stripe keys.
      </p>
    </div>
    <div class="modal-footer">
      <span id="checkoutStatus" class="note"></span>
      <button class="btn" id="confirmCheckoutBtn">Confirm &amp; Pay</button>
    </div>
  </div>
</div>

<!-- Vouch modal -->
<div class="modal-backdrop" id="vouchBackdrop">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Rate your Moon Inc. order</div>
      <button class="modal-close" data-close="vouchBackdrop">&times;</button>
    </div>
    <div class="modal-body">
      <p style="margin-bottom:0.5rem;">
        Pick a rating from 1‚Äì5 stars. If you close this and don‚Äôt rate within ~20 minutes, a neutral-positive rating will be auto-generated.
      </p>
      <div id="vouchStarRow" style="font-size:1.6rem;margin:0.2rem 0 0.4rem;cursor:pointer;">
        <!-- stars injected via JS -->
      </div>
      <p class="note">
        Vouches are anonymous. Public only sees a masked name and the EST time ‚Äî admins and Discord logs can see full order info.
      </p>
    </div>
    <div class="modal-footer">
      <span id="vouchStatus" class="note"></span>
      <button class="btn-outline" id="skipVouchBtn">Skip</button>
      <button class="btn" id="submitVouchBtn">Submit rating</button>
    </div>
  </div>
</div>

<!-- Admin panel -->
<button class="admin-toggle" id="adminToggle">
  ‚öôÔ∏è Admin
</button>

<div class="admin-panel" id="adminPanel">
  <div class="admin-header">
    <div>
      <div class="admin-title">Moon Inc. Admin</div>
      <div style="font-size:0.76rem;color:var(--text-muted);">
        Password: <code>LOOTTECHONTOP</code> (one-time per session)
      </div>
    </div>
    <button class="modal-close" id="adminCloseBtn">&times;</button>
  </div>
  <div class="admin-body">
    <div id="adminLockView">
      <p style="margin-bottom:0.6rem;">
        Enter the admin password to unlock the dashboard. Changes affect prices, visibility, and catalog.
      </p>
      <div class="field">
        <label for="adminPassword">Admin password</label>
        <input type="password" id="adminPassword" placeholder="Password" />
        <div id="adminPasswordError" class="error-text">Incorrect password.</div>
      </div>
      <button class="btn" id="unlockAdminBtn" style="margin-top:0.4rem;">Unlock admin panel</button>
    </div>

    <div id="adminMainView" style="display:none;">
      <div class="admin-section-title">Catalog</div>
      <table class="admin-table" id="adminTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>Cat</th>
            <th>$</th>
            <th>Stock</th>
            <th>Feat</th>
            <th>Arch</th>
          </tr>
        </thead>
        <tbody><!-- rows injected --></tbody>
      </table>

      <div class="admin-actions">
        <button class="btn-xs btn-xs-primary" id="adminSaveCatalog">Save changes</button>
        <button class="btn-xs" id="adminUndo">Undo last</button>
        <button class="btn-xs" id="adminReset">Reset to defaults</button>
      </div>

      <div class="admin-section-title">Add item</div>
      <div class="field">
        <label>Name</label>
        <input id="newItemName" placeholder="Item name" />
      </div>
      <div class="field">
        <label>Category</label>
        <select id="newItemCategory">
          <option value="spawner">Spawner</option>
          <option value="kit">Kit</option>
          <option value="currency">Currency</option>
        </select>
      </div>
      <div class="field">
        <label>Price (USD)</label>
        <input id="newItemPrice" placeholder="0.00" />
      </div>
      <div class="field">
        <label>Stock</label>
        <input id="newItemStock" placeholder="‚àû or number" />
      </div>
      <div class="field">
        <label>Image URL (optional)</label>
        <input id="newItemImage" placeholder="https://..." />
      </div>
      <button class="btn-xs btn-xs-primary" id="adminAddItem" style="margin-top:0.3rem;">Add item</button>

      <div class="admin-section-title">Recent catalog changes</div>
      <div class="admin-log" id="adminLog"></div>
    </div>
  </div>
</div>

<script>
  /************ STARFIELD ************/
  const starCanvas = document.getElementById("starfield");
  const starCtx = starCanvas.getContext("2d");
  let SW, SH;
  let stars = [];
  const STAR_COUNT = 160;
  const MAX_RADIUS = 2.1;

  function resizeStars() {
    SW = starCanvas.width = window.innerWidth;
    SH = starCanvas.height = window.innerHeight;
  }
  resizeStars();
  window.addEventListener("resize", resizeStars);

  for (let i = 0; i < STAR_COUNT; i++) {
    stars.push({
      x: Math.random() * SW,
      y: Math.random() * SH,
      r: Math.random() * MAX_RADIUS + 0.4,
      a: Math.random(),
      fadeSpeed: (Math.random() * 0.013) + 0.003,
      driftX: (Math.random() * 0.4) - 0.2,
      driftY: (Math.random() * 0.4) - 0.2,
    });
  }

  function drawStars() {
    starCtx.clearRect(0, 0, SW, SH);
    stars.forEach(s => {
      s.a += s.fadeSpeed;
      if (s.a >= 1 || s.a <= 0) s.fadeSpeed *= -1;

      s.x += s.driftX;
      s.y += s.driftY;

      if (s.x < 0 || s.x > SW || s.y < 0 || s.y > SH || Math.random() < 0.0008) {
        s.x = Math.random() * SW;
        s.y = Math.random() * SH;
        s.r = Math.random() * MAX_RADIUS + 0.4;
        s.a = Math.random();
      }
      const glow = starCtx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r * 4);
      glow.addColorStop(0, `rgba(255,255,255,${s.a})`);
      glow.addColorStop(0.6, `rgba(150,100,255,${s.a * 0.35})`);
      glow.addColorStop(1, `rgba(0,0,0,0)`);
      starCtx.fillStyle = glow;
      starCtx.beginPath();
      starCtx.arc(s.x, s.y, s.r * 4, 0, Math.PI * 2);
      starCtx.fill();

      starCtx.fillStyle = `rgba(255,255,255,${s.a})`;
      starCtx.beginPath();
      starCtx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      starCtx.fill();
    });
    requestAnimationFrame(drawStars);
  }
  drawStars();

  /************ DATA + STORAGE ************/
  const STORAGE_KEY = "mooninc_catalog_v1";
  const VOUCH_KEY = "mooninc_vouches_v1";
  const ORDER_COUNT_KEY = "mooninc_order_count_v1";

  const defaultCatalog = [
    {
      id: "cow-spawner",
      name: "Cow Spawner",
      category: "spawner",
      price: 0.10,
      stock: "‚àû",
      rarity: "common",
      featured: true,
      archived: false,
      image: "",
    },
    {
      id: "blaze-spawner",
      name: "Blaze Spawner",
      category: "spawner",
      price: 0.12,
      stock: "‚àû",
      rarity: "rare",
      featured: true,
      archived: false,
      image: "",
    },
    {
      id: "starter-kit",
      name: "Starter Kit",
      category: "kit",
      price: 0.35,
      stock: "‚àû",
      rarity: "common",
      featured: false,
      archived: false,
      image: "",
    },
    {
      id: "pvp-kit",
      name: "PvP Kit",
      category: "kit",
      price: 0.5,
      stock: "‚àû",
      rarity: "legendary",
      featured: true,
      archived: false,
      image: "",
    },
    {
      id: "cur-1m",
      name: "1M Currency Bundle",
      category: "currency",
      price: 0.25,
      stock: "‚àû",
      rarity: "common",
      featured: false,
      archived: false,
      image: "",
    },
    {
      id: "cur-5m",
      name: "5M Currency Bundle",
      category: "currency",
      price: 0.8,
      stock: "‚àû",
      rarity: "rare",
      featured: true,
      archived: false,
      image: "",
    }
  ];

  let catalog = [];
  let catalogUndoStack = [];
  let cart = [];
  let vouches = [];
  let orderCount = 0;

  function loadCatalog() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (raw) {
      try {
        catalog = JSON.parse(raw);
      } catch {
        catalog = JSON.parse(JSON.stringify(defaultCatalog));
      }
    } else {
      catalog = JSON.parse(JSON.stringify(defaultCatalog));
    }
  }
  function saveCatalog() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(catalog));
  }
  function pushUndoSnapshot() {
    catalogUndoStack.push(JSON.stringify(catalog));
    if (catalogUndoStack.length > 10) catalogUndoStack.shift();
  }
  function loadVouches() {
    const raw = localStorage.getItem(VOUCH_KEY);
    if (raw) {
      try { vouches = JSON.parse(raw); } catch { vouches = []; }
    } else vouches = [];
  }
  function saveVouches() {
    localStorage.setItem(VOUCH_KEY, JSON.stringify(vouches));
  }
  function loadOrderCount() {
    const raw = localStorage.getItem(ORDER_COUNT_KEY);
    orderCount = raw ? parseInt(raw,10) || 0 : 0;
  }
  function saveOrderCount() {
    localStorage.setItem(ORDER_COUNT_KEY, String(orderCount));
  }

  loadCatalog();
  loadVouches();
  loadOrderCount();

  /************ SHOP RENDER ************/
  const featuredGridEl = document.getElementById("featuredGrid");
  const productGridEl = document.getElementById("productGrid");
  const cartItemsEl = document.getElementById("cartItems");
  const cartCountTextEl = document.getElementById("cartCountText");
  const cartSubtotalEl = document.getElementById("cartSubtotal");
  const cartFeesEl = document.getElementById("cartFees");
  const cartTotalEl = document.getElementById("cartTotal");
  const cartEmptyTextEl = document.getElementById("cartEmptyText");
  const heroOrdersMetric = document.getElementById("heroOrdersMetric");
  const heroArchivedCount = document.getElementById("heroArchivedCount");
  const heroAvgRating = document.getElementById("heroAvgRating");

  function formatPrice(p) {
    if (typeof p !== "number" || isNaN(p)) return "$‚Äî";
    return "$" + p.toFixed(2);
  }

  function rarityBadgeClass(r) {
    if (r === "rare") return "badge badge-rare";
    if (r === "legendary") return "badge badge-legendary";
    return "badge badge-common";
  }

  function renderFeatured() {
    featuredGridEl.innerHTML = "";
    const active = catalog.filter(p => p.featured && !p.archived && typeof p.price === "number" && !isNaN(p.price));
    if (!active.length) {
      featuredGridEl.innerHTML = "<p style='font-size:0.82rem;color:var(--text-muted);'>No featured items yet. Mark some in the admin panel.</p>";
      return;
    }
    active.forEach(p => {
      const card = document.createElement("article");
      card.className = "card";
      card.innerHTML = `
        <span class="card-featured-tag">Featured</span>
        <div class="card-img">
          ${p.image ? `<img src="${p.image}" alt="${p.name}">` : "‚òÖ"}
        </div>
        <div class="card-title">${p.name}</div>
        <div class="card-meta">
          <span class="price">${formatPrice(p.price)}</span>
          <span class="${rarityBadgeClass(p.rarity)}">${p.rarity || "common"}</span>
        </div>
        <div class="card-meta">
          <span class="stock">${p.stock === "‚àû" ? "Stock: ‚àû" : "Stock: " + p.stock}</span>
          <span style="font-size:0.76rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.14em;">
            ${p.category}
          </span>
        </div>
        <div class="card-footer">
          <button class="btn-sm" data-add="${p.id}">Add to cart</button>
          <button class="btn-sm btn-sm-ghost" data-more="${p.id}">Details</button>
        </div>
      `;
      featuredGridEl.appendChild(card);
    });
  }

  let activeCategoryFilter = "all";

  function renderProductGrid() {
    productGridEl.innerHTML = "";
    let list = catalog.filter(p => !p.archived && typeof p.price === "number" && !isNaN(p.price));
    if (activeCategoryFilter !== "all") {
      list = list.filter(p => p.category === activeCategoryFilter);
    }
    if (!list.length) {
      productGridEl.innerHTML = "<p style='font-size:0.82rem;color:var(--text-muted);'>No items in this category yet.</p>";
      return;
    }
    list.forEach(p => {
      const card = document.createElement("article");
      card.className = "card";
      card.innerHTML = `
        ${p.featured ? `<span class="card-featured-tag">Featured</span>` : ""}
        <div class="card-img">
          ${p.image ? `<img src="${p.image}" alt="${p.name}">` : "‚ú¶"}
        </div>
        <div class="card-title">${p.name}</div>
        <div class="card-meta">
          <span class="price">${formatPrice(p.price)}</span>
          <span class="${rarityBadgeClass(p.rarity)}">${p.rarity || "common"}</span>
        </div>
        <div class="card-meta">
          <span class="stock">${p.stock === "‚àû" ? "Stock: ‚àû" : "Stock: " + p.stock}</span>
          <span style="font-size:0.76rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.14em;">
            ${p.category}
          </span>
        </div>
        <div class="card-footer">
          <button class="btn-sm" data-add="${p.id}">Add</button>
          <button class="btn-sm btn-sm-ghost" data-more="${p.id}">Details</button>
        </div>
      `;
      productGridEl.appendChild(card);
    });
  }

  function renderCart() {
    cartItemsEl.innerHTML = "";
    if (!cart.length) {
      cartEmptyTextEl.style.display = "block";
    } else {
      cartEmptyTextEl.style.display = "none";
    }

    let subtotal = 0;
    cart.forEach(item => {
      const product = catalog.find(p => p.id === item.id);
      if (!product) return;
      const line = product.price * item.qty;
      subtotal += line;
      const row = document.createElement("div");
      row.className = "cart-item";
      row.innerHTML = `
        <div class="cart-item-main">
          <span class="cart-item-name">${product.name}</span>
          <span class="cart-item-meta">${formatPrice(product.price)} ‚Ä¢ ${product.category}</span>
        </div>
        <div class="cart-item-actions">
          <div class="qty-controls">
            <button class="qty-btn" data-dec="${product.id}">-</button>
            <span>${item.qty}</span>
            <button class="qty-btn" data-inc="${product.id}">+</button>
          </div>
          <button class="btn-xs" data-remove="${product.id}">Remove</button>
        </div>
      `;
      cartItemsEl.appendChild(row);
    });

    cartCountTextEl.textContent = cart.length + (cart.length === 1 ? " item" : " items");
    const fees = subtotal > 0 ? Math.max(0.05, subtotal * 0.03) : 0;
    const total = subtotal + fees;
    cartSubtotalEl.textContent = formatPrice(subtotal);
    cartFeesEl.textContent = formatPrice(fees);
    cartTotalEl.textContent = formatPrice(total);
  }

  function refreshHeroMeta() {
    heroOrdersMetric.textContent = orderCount;
    const archivedCount = catalog.filter(p => p.archived).length;
    heroArchivedCount.textContent = archivedCount;
    if (!vouches.length) {
      heroAvgRating.textContent = "‚Äî";
    } else {
      const avg = vouches.reduce((s,v)=>s+v.stars,0)/vouches.length;
      heroAvgRating.textContent = avg.toFixed(2) + "‚òÖ (" + vouches.length + ")";
    }
  }

  function renderAll() {
    renderFeatured();
    renderProductGrid();
    renderCart();
    renderVouches();
    refreshHeroMeta();
  }

  /************ CART LOGIC ************/
  function addToCart(id) {
    const prod = catalog.find(p => p.id === id && !p.archived && typeof p.price === "number" && !isNaN(p.price));
    if (!prod) return;
    const existing = cart.find(i => i.id === id);
    if (existing) existing.qty++;
    else cart.push({id, qty:1});
    renderCart();
  }
  function changeQty(id, delta) {
    const item = cart.find(i => i.id === id);
    if (!item) return;
    item.qty += delta;
    if (item.qty <= 0) {
      cart = cart.filter(i => i.id !== id);
    }
    renderCart();
  }
  function removeFromCart(id) {
    cart = cart.filter(i => i.id !== id);
    renderCart();
  }

  document.body.addEventListener("click", e => {
    const addId = e.target.getAttribute("data-add");
    if (addId) {
      addToCart(addId);
      return;
    }
    const moreId = e.target.getAttribute("data-more");
    if (moreId) {
      alert("Details placeholder. You can expand this later if you want per-item descriptions.");
      return;
    }
    const decId = e.target.getAttribute("data-dec");
    if (decId) {
      changeQty(decId, -1);
      return;
    }
    const incId = e.target.getAttribute("data-inc");
    if (incId) {
      changeQty(incId, 1);
      return;
    }
    const remId = e.target.getAttribute("data-remove");
    if (remId) {
      removeFromCart(remId);
      return;
    }
  });

  /************ CATEGORY FILTER ************/
  document.querySelectorAll(".chip").forEach(chip => {
    chip.addEventListener("click", () => {
      document.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));
      chip.classList.add("active");
      activeCategoryFilter = chip.getAttribute("data-category") || "all";
      renderProductGrid();
    });
  });

  /************ SCROLL BUTTONS ************/
  function scrollToElement(id) {
    const el = document.getElementById(id);
    if (!el) return;
    const y = el.getBoundingClientRect().top + window.scrollY - 80;
    window.scrollTo({top:y, behavior:"smooth"});
  }
  document.getElementById("scrollToShop").addEventListener("click", () => scrollToElement("shop"));
  document.getElementById("scrollToVouches").addEventListener("click", () => scrollToElement("vouches"));

  /************ CHECKOUT + "STRIPE" ************/
  const checkoutBackdrop = document.getElementById("checkoutBackdrop");
  const checkoutDiscordInput = document.getElementById("checkoutDiscord");
  const checkoutIGNInput = document.getElementById("checkoutIGN");
  const checkoutNoteInput = document.getElementById("checkoutNote");
  const checkoutDiscordError = document.getElementById("checkoutDiscordError");
  const checkoutIGNError = document.getElementById("checkoutIGNError");
  const checkoutStatus = document.getElementById("checkoutStatus");
  const confirmCheckoutBtn = document.getElementById("confirmCheckoutBtn");

  document.getElementById("checkoutBtn").addEventListener("click", () => {
    if (!cart.length) {
      alert("Cart is empty.");
      return;
    }
    checkoutStatus.textContent = "";
    checkoutDiscordError.style.display = "none";
    checkoutIGNError.style.display = "none";
    checkoutBackdrop.classList.add("show");
  });

  document.querySelectorAll("[data-close]").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-close");
      const el = document.getElementById(id);
      if (el) el.classList.remove("show");
    });
  });

  function validateCheckout() {
    let valid = true;
    const disc = checkoutDiscordInput.value.trim();
    const ign = checkoutIGNInput.value.trim();
    checkoutDiscordError.style.display = "none";
    checkoutIGNError.style.display = "none";
    if (!disc || disc.length < 3) {
      checkoutDiscordError.style.display = "block";
      valid = false;
    }
    if (!ign || ign.length < 2) {
      checkoutIGNError.style.display = "block";
      valid = false;
    }
    return valid;
  }

  // Placeholder: you hook real Stripe via backend
  function simulateStripePayment(orderTotal, cb) {
    checkoutStatus.textContent = "Contacting Stripe-style payment (demo)...";
    confirmCheckoutBtn.disabled = true;
    confirmCheckoutBtn.textContent = "Processing...";
    setTimeout(() => {
      const fakeTxn = "TXN#" + Math.random().toString(36).slice(2, 10).toUpperCase();
      cb({ ok: true, txn: fakeTxn });
      confirmCheckoutBtn.disabled = false;
      confirmCheckoutBtn.textContent = "Confirm & Pay";
    }, 900);
  }

  const WEBHOOK_URL = "https://discord.com/api/webhooks/1446305226201239582/8lYD0XyrJxC2CloYHMnzCA3jaMk-SyIXlvh6WV_3qEKc2XfvCuc55tZDive4vUD5oRqA"; // TODO: set real webhook

  function sendDiscordWebhook(order, vouchStarsOrNull, autoFlag) {
    if (!WEBHOOK_URL || WEBHOOK_URL.startsWith("PUT_")) {
      console.warn("Webhook URL not set. Skipping.");
      return;
    }
    const now = new Date();
    const orderTime = formatTimestampEST(now);
    const itemsDesc = order.items.map(i => `${i.qty}x ${i.name}`).join(", ");
    const starsText = vouchStarsOrNull != null ? `${vouchStarsOrNull} stars` : "Not yet";

    const embed = {
      title: "üåô Moon Inc. ‚Äî New Order",
      color: 0x8e5cff,
      fields: [
        { name: "üë§ Buyer", value: order.discord || "Unknown", inline: true },
        { name: "üéÆ IGN", value: order.ign || "Unknown", inline: true },
        { name: "üõí Items", value: itemsDesc || "None", inline: false },
        { name: "üí∏ Price", value: formatPrice(order.total), inline: true },
        { name: "‚è± Time (EST)", value: orderTime, inline: true },
        { name: "üîó Stripe", value: order.txn || "Simulated", inline: false },
        { name: "‚≠ê Vouch", value: `${starsText}${autoFlag ? " (auto)" : ""}`, inline: false },
      ],
      footer: {
        text: "Securely logged by Moon Inc. Admin Panel",
      },
    };

    fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ embeds: [embed] }),
    }).catch(err => console.error("Webhook error:", err));
  }

  let lastOrderForVouch = null;
  let autoVouchTimer = null;
  const vouchBackdrop = document.getElementById("vouchBackdrop");
  const vouchStarRow = document.getElementById("vouchStarRow");
  const vouchStatus = document.getElementById("vouchStatus");
  const submitVouchBtn = document.getElementById("submitVouchBtn");
  const skipVouchBtn = document.getElementById("skipVouchBtn");
  let selectedVouchStars = 0;

  const cosmicNames = [
    "NebulaWalker","VoidDrifter","StarRevenant","CometShade","LunarCipher",
    "Dustborne","SolTrace","ChronoFragment","OrbitGhost","NightComet"
  ];

  function formatTimestampEST(date) {
    const opt = {
      year:"numeric", month:"short", day:"2-digit",
      hour:"2-digit", minute:"2-digit",
      hour12:true
    };
    const parts = new Intl.DateTimeFormat("en-US", opt).formatToParts(date);
    const map = {};
    parts.forEach(p => map[p.type] = p.value);
    return `${map.month} ${map.day}, ${map.year} ‚Äî ${map.hour}:${map.minute} ${map.dayPeriod} EST`;
  }

  function randomMaskedName() {
    const base = cosmicNames[Math.floor(Math.random()*cosmicNames.length)];
    const num = Math.floor(Math.random()*200)+1;
    return `${base} #${num}`;
  }

  function renderVouches() {
    const vouchListEl = document.getElementById("vouchList");
    vouchListEl.innerHTML = "";
    if (!vouches.length) {
      vouchListEl.innerHTML = "<p style='font-size:0.82rem;color:var(--text-muted);'>No vouches yet. Once orders start flowing, ratings will appear here.</p>";
      return;
    }
    const copy = [...vouches].slice(-25).reverse();
    copy.forEach(v => {
      const div = document.createElement("div");
      div.className = "vouch-item";
      const stars = "‚òÖ".repeat(v.stars) + "‚òÜ".repeat(5 - v.stars);
      div.innerHTML = `
        <div class="vouch-stars">${stars}</div>
        <div class="vouch-meta">
          Guest ‚Ä¢ ${v.maskedName}<br>
          ${v.timestamp}
        </div>
      `;
      vouchListEl.appendChild(div);
    });
  }

  function openVouchModal(order) {
    lastOrderForVouch = order;
    selectedVouchStars = 0;
    vouchStatus.textContent = "";
    renderVouchStars();
    vouchBackdrop.classList.add("show");

    if (autoVouchTimer) clearTimeout(autoVouchTimer);
    autoVouchTimer = setTimeout(() => {
      if (!lastOrderForVouch) return;
      createVouchForOrder(lastOrderForVouch, 4 + Math.round(Math.random())); // 4‚Äì5 stars
      lastOrderForVouch = null;
      vouchBackdrop.classList.remove("show");
    }, 20 * 60 * 1000); // 20 minutes
  }

  function renderVouchStars() {
    vouchStarRow.innerHTML = "";
    for (let i=1;i<=5;i++) {
      const span = document.createElement("span");
      span.textContent = i <= selectedVouchStars ? "‚òÖ" : "‚òÜ";
      span.style.marginRight = "0.15rem";
      span.setAttribute("data-star", i);
      vouchStarRow.appendChild(span);
    }
  }

  vouchStarRow.addEventListener("click", e => {
    const s = e.target.getAttribute("data-star");
    if (!s) return;
    selectedVouchStars = parseInt(s,10);
    renderVouchStars();
  });

  function createVouchForOrder(order, stars, autoFlag = false) {
    if (!stars || stars < 1 || stars > 5) return;
    const ts = formatTimestampEST(new Date());
    const masked = randomMaskedName();
    vouches.push({
      stars,
      maskedName: masked,
      timestamp: ts,
      auto: autoFlag,
      orderId: order.id || null,
    });
    saveVouches();
    renderVouches();
    refreshHeroMeta();
    sendDiscordWebhook(order, stars, autoFlag);
  }

  submitVouchBtn.addEventListener("click", () => {
    if (!lastOrderForVouch) {
      vouchStatus.textContent = "No order to vouch for.";
      return;
    }
    if (!selectedVouchStars) {
      vouchStatus.textContent = "Please pick a rating between 1‚Äì5 stars.";
      return;
    }
    createVouchForOrder(lastOrderForVouch, selectedVouchStars, false);
    lastOrderForVouch = null;
    if (autoVouchTimer) clearTimeout(autoVouchTimer);
    vouchBackdrop.classList.remove("show");
  });

  skipVouchBtn.addEventListener("click", () => {
    vouchStatus.textContent = "You can close this. If no rating is set in ~20 minutes, a neutral rating is auto-generated.";
  });

  confirmCheckoutBtn.addEventListener("click", () => {
    if (!validateCheckout()) return;
    const discord = checkoutDiscordInput.value.trim();
    const ign = checkoutIGNInput.value.trim();
    const note = checkoutNoteInput.value.trim();
    let subtotal=0;
    const items = cart.map(ci => {
      const p = catalog.find(pp => pp.id === ci.id);
      if (!p) return null;
      subtotal += p.price * ci.qty;
      return { id:p.id, name:p.name, category:p.category, qty:ci.qty, price:p.price };
    }).filter(Boolean);
    const fees = subtotal > 0 ? Math.max(0.05, subtotal*0.03) : 0;
    const total = subtotal + fees;
    const orderId = "ORD-" + Date.now().toString(36);
    const order = {
      id: orderId,
      discord,
      ign,
      note,
      items,
      total,
      createdAt: new Date().toISOString(),
      txn: null,
    };
    simulateStripePayment(total, res => {
      if (!res.ok) {
        checkoutStatus.textContent = "Payment failed. Try again.";
        return;
      }
      order.txn = res.txn;
      orderCount++;
      saveOrderCount();
      sendDiscordWebhook(order, null, false); // log order right away
      checkoutStatus.textContent = "Payment confirmed (demo). Order logged.";
      cart = [];
      renderCart();
      refreshHeroMeta();
      setTimeout(() => {
        checkoutBackdrop.classList.remove("show");
        openVouchModal(order);
      }, 500);
    });
  });

  /************ ADMIN PANEL ************/
  const adminToggle = document.getElementById("adminToggle");
  const adminPanel = document.getElementById("adminPanel");
  const adminCloseBtn = document.getElementById("adminCloseBtn");
  const adminPasswordInput = document.getElementById("adminPassword");
  const adminPasswordError = document.getElementById("adminPasswordError");
  const unlockAdminBtn = document.getElementById("unlockAdminBtn");
  const adminLockView = document.getElementById("adminLockView");
  const adminMainView = document.getElementById("adminMainView");
  const adminTableBody = document.querySelector("#adminTable tbody");
  const adminLog = document.getElementById("adminLog");
  const adminSaveCatalogBtn = document.getElementById("adminSaveCatalog");
  const adminUndoBtn = document.getElementById("adminUndo");
  const adminResetBtn = document.getElementById("adminReset");
  const adminAddItemBtn = document.getElementById("adminAddItem");

  function logAdmin(msg) {
    const time = formatTimestampEST(new Date());
    const p = document.createElement("p");
    p.textContent = `[${time}] ${msg}`;
    adminLog.prepend(p);
  }

  adminToggle.addEventListener("click", () => {
    adminPanel.classList.add("open");
  });
  adminCloseBtn.addEventListener("click", () => {
    adminPanel.classList.remove("open");
  });

  unlockAdminBtn.addEventListener("click", () => {
    const val = adminPasswordInput.value;
    if (val === "LOOTTECHONTOP") {
      adminPasswordError.style.display = "none";
      adminLockView.style.display = "none";
      adminMainView.style.display = "block";
      renderAdminTable();
      logAdmin("Admin unlocked.");
    } else {
      adminPasswordError.style.display = "block";
    }
  });

  function renderAdminTable() {
    adminTableBody.innerHTML = "";
    catalog.forEach((p, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input data-field="name" data-idx="${idx}" value="${p.name}"></td>
        <td>
          <select data-field="category" data-idx="${idx}">
            <option value="spawner" ${p.category==="spawner"?"selected":""}>S</option>
            <option value="kit" ${p.category==="kit"?"selected":""}>K</option>
            <option value="currency" ${p.category==="currency"?"selected":""}>C</option>
          </select>
        </td>
        <td><input data-field="price" data-idx="${idx}" value="${(typeof p.price==="number" ? p.price.toFixed(2) : "")}"></td>
        <td><input data-field="stock" data-idx="${idx}" value="${p.stock}"></td>
        <td><input type="checkbox" data-field="featured" data-idx="${idx}" ${p.featured?"checked":""}></td>
        <td><input type="checkbox" data-field="archived" data-idx="${idx}" ${p.archived?"checked":""}></td>
      `;
      adminTableBody.appendChild(tr);
    });
  }

  adminTableBody.addEventListener("input", e => {
    const field = e.target.getAttribute("data-field");
    const idxStr = e.target.getAttribute("data-idx");
    if (!field || idxStr == null) return;
    const idx = parseInt(idxStr,10);
    const p = catalog[idx];
    if (!p) return;
    if (field === "name") p.name = e.target.value;
    else if (field === "category") p.category = e.target.value;
    else if (field === "price") {
      const v = parseFloat(e.target.value);
      if (isNaN(v)) p.price = null;
      else p.price = v;
    } else if (field === "stock") {
      p.stock = e.target.value || "‚àû";
    } else if (field === "featured") {
      p.featured = !!e.target.checked;
    } else if (field === "archived") {
      p.archived = !!e.target.checked;
    }
  });

  adminSaveCatalogBtn.addEventListener("click", () => {
    pushUndoSnapshot();
    saveCatalog();
    renderAll();
    logAdmin("Catalog changes saved.");
  });
  adminUndoBtn.addEventListener("click", () => {
    if (!catalogUndoStack.length) {
      logAdmin("Nothing to undo.");
      return;
    }
    const last = catalogUndoStack.pop();
    try {
      catalog = JSON.parse(last);
      saveCatalog();
      renderAll();
      renderAdminTable();
      logAdmin("Reverted last catalog change.");
    } catch {
      logAdmin("Failed to undo.");
    }
  });
  adminResetBtn.addEventListener("click", () => {
    if (!confirm("Reset catalog to defaults? This overrides current items.")) return;
    pushUndoSnapshot();
    catalog = JSON.parse(JSON.stringify(defaultCatalog));
    saveCatalog();
    renderAll();
    renderAdminTable();
    logAdmin("Catalog reset to defaults.");
  });

  adminAddItemBtn.addEventListener("click", () => {
    const nameEl = document.getElementById("newItemName");
    const catEl = document.getElementById("newItemCategory");
    const priceEl = document.getElementById("newItemPrice");
    const stockEl = document.getElementById("newItemStock");
    const imgEl = document.getElementById("newItemImage");
    const name = nameEl.value.trim();
    if (!name) {
      alert("Item name required.");
      return;
    }
    const category = catEl.value;
    const price = parseFloat(priceEl.value);
    const stock = stockEl.value.trim() || "‚àû";
    const image = imgEl.value.trim();
    const idBase = name.toLowerCase().replace(/[^a-z0-9]+/g,"-");
    const id = idBase + "-" + Math.random().toString(36).slice(2,5);
    const item = {
      id,
      name,
      category,
      price: isNaN(price) ? null : price,
      stock,
      rarity: "common",
      featured: false,
      archived: false,
      image,
    };
    pushUndoSnapshot();
    catalog.push(item);
    saveCatalog();
    renderAll();
    renderAdminTable();
    logAdmin(`Added item "${name}" (${category}).`);
    nameEl.value = "";
    priceEl.value = "";
    stockEl.value = "";
    imgEl.value = "";
  });

  /************ INITIALIZE ************/
  document.getElementById("yearSpan").textContent = new Date().getFullYear();
  renderAll();
</script>
</body>
</html>
